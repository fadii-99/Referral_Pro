import{u as Y,r as a,R as E,j as e}from"./index-BPYl9JkP.js";import{S as O}from"./SideDesign-CwOeahE1.js";import{B as R}from"./Button-Ao4J6QCP.js";import{M as $}from"./MultiStepHeader-DYy68rvm.js";import{L,y as n}from"./ReactToastify-BP_TAh3k.js";const W="/api",x=r=>r.replace(/\D/g,""),F=r=>x(r).slice(0,16).replace(/(\d{4})(?=\d)/g,"$1 ").trim(),I=r=>{if(!/^\d{4}-\d{2}$/.test(r))return"";const[o,d]=r.split("-");return`${d}/${o.slice(-2)}`},J=()=>{const r=Y(),o=a.useRef(null),d=a.useContext(E);if(!d)throw new Error("Wrap your app with <RegistrationProvider /> first.");const{registrationData:t,finishSignup:N}=d,[h,b]=a.useState(""),[l,f]=a.useState(""),[c,v]=a.useState(""),[p,w]=a.useState(""),[y,g]=a.useState(!1),C=a.useMemo(()=>x(l).length,[l]),k=s=>f(F(s)),S=s=>w(x(s).slice(0,3)),M=async()=>{if(y)return;const s=t.paymentType==="stripe",P=t.paymentType==="bank";if(!s&&!P){n.error("Please select a payment method (bank or stripe) on the previous step.");return}if(!h.trim()||!l.trim()||!c||!p.trim()){n.error("Please fill out card name, number, expiry and CVV.");return}if(C!==16){n.error("Card number must be 16 digits.");return}if(p.length!==3){n.error(p.length>3?"CVV is too long (3 digits required).":"CVV is too short (3 digits required).");return}if(!/^\d{4}-\d{2}$/.test(c)){n.error("Expiry must be a valid month (YYYY-MM).");return}g(!0);try{const m=t.profileType==="company",V=I(c),B={welcome:{role:"Business",profileType:t.profileType||""},basic:{firstName:t.firstName,lastName:t.lastName,industry:t.industry,email:t.email,...m?{companyName:t.companyName}:{}},businessType:{type:m&&t.bizType||"sole",years:t.years,employees:t.employees,usState:t.usState},companyInfo:{address1:t.address1,address2:t.address2,city:t.city,postCode:t.postCode,phone:t.phone,website:t.website},subscription:{billing:t.subscriptionBilling,planId:t.subscriptionPlanId===null?null:Number(t.subscriptionPlanId),seats:Number(t.subscriptionSeats),currency:t.subscriptionCurrency||"USD",total:Number(t.subscriptionTotal||0),totalDisplay:t.subscriptionTotalDisplay||""},payment:{paymentType:t.paymentType,charge:{currency:t.subscriptionCurrency||"USD",total:Number(t.subscriptionTotal||0),totalDisplay:t.subscriptionTotalDisplay||""},card:{name:h.trim(),number:x(l),expiry:{monthValue:c,mmYY:V},cvv:p}},password:{value:t.password||""}},j=new FormData;j.append("payload",JSON.stringify(B));const u=await fetch(`${W}/auth/sign_up/`,{method:"POST",body:j}),i=(u.headers.get("content-type")||"").includes("application/json")?await u.json():await u.text();if(!u.ok){const D=i&&typeof i!="string"&&(i.error||i.detail||i.message)||(typeof i=="string"?i:"Payment submit failed");n.error(D),g(!1);return}n.success("Signup successful!"),setTimeout(()=>{N({clear:!0}),b(""),f(""),v(""),w(""),r("/Login",{replace:!0})},2e3)}catch(m){console.error(m),n.error("Something went wrong. Try again."),g(!1)}},T=t.paymentType==="stripe";return e.jsxs("div",{className:"grid md:grid-cols-5 w-full min-h-screen",children:[e.jsx(O,{}),e.jsxs("div",{className:"md:col-span-3 flex flex-col bg-[#F4F2FA]",children:[e.jsx("div",{className:"sticky top-5 z-30 backdrop-blur w-full max-w-lg mx-auto",children:e.jsx("div",{className:"px-4",children:e.jsx($,{title:"Payment Method",current:6,total:6,onBack:()=>r(-1)})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:"Card Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("path",{d:"M12 12a4 4 0 100-8 4 4 0 000 8Z"}),e.jsx("path",{d:"M3 20a9 9 0 0118 0"})]})}),e.jsx("input",{type:"text",placeholder:"Card Name",value:h,onChange:s=>b(s.target.value),className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:"Card Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2"}),e.jsx("path",{d:"M3 10h18"})]})}),e.jsx("input",{inputMode:"numeric",maxLength:19,placeholder:"0000 0000 0000 0000",value:l,onChange:s=>k(s.target.value),className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:"Expiry"}),e.jsxs("div",{className:"relative",onClick:()=>{const s=o.current;s&&(s.showPicker?s.showPicker():s.focus())},role:"button","aria-label":"Open expiry month picker",children:[e.jsx("span",{className:"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:e.jsx("path",{d:"M7 4v3M17 4v3M4 9h16M5 20h14a2 2 0 0 0 2-2v-9H3v9a2 2 0 0 0 2 2Z"})})}),e.jsx("input",{ref:o,type:"month",value:c,onChange:s=>v(s.target.value),className:["w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200","text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none","[&::-webkit-calendar-picker-indicator]:opacity-0","[&::-webkit-calendar-picker-indicator]:pointer-events-none","appearance-none","pointer-events-none"].join(" "),"aria-haspopup":"dialog"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:"CVV"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("path",{d:"M12 2l7 4v6c0 5-3.5 9-7 10-3.5-1-7-5-7-10V6l7-4z"}),e.jsx("path",{d:"M12 11v4"}),e.jsx("circle",{cx:"12",cy:"9",r:"1"})]})}),e.jsx("input",{inputMode:"numeric",placeholder:"CVV",value:p,onChange:s=>S(s.target.value),maxLength:3,className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]})]}),e.jsx("p",{className:"text-[11px] text-gray-500 text-center",children:T?"Payments secured by Stripe":"Bank transfer will be processed manually"}),e.jsx(R,{text:y?"Processing...":"Save & Continue",onClick:M,disabled:y}),e.jsx("p",{className:"mt-2 text-center text-[11px] text-gray-500",children:"Terms of Service | Privacy Policy"})]})})]}),e.jsx(L,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})]})};export{J as default};
