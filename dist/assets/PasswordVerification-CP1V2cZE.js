import{r as u,u as _,a as $,R as V,j as o}from"./index-BNIc-81g.js";import{S as A}from"./SideDesign-DO8VOQT9.js";import{B as M}from"./Button-BhICDQhy.js";import{L as B,y as d}from"./ReactToastify-DDtY7yYu.js";const R=85,C="/api",G=()=>{const[c,p]=u.useState(Array(6).fill("")),a=u.useRef([]),[x,h]=u.useState(!1),[g,y]=u.useState(!1),[m,w]=u.useState(R),E=_(),k=$().state?.email||"",v=u.useContext(V);if(!v)throw new Error("Wrap your app with <RegistrationProvider />");const{setTempToken:P}=v;u.useEffect(()=>{a.current[0]?.focus()},[]),u.useEffect(()=>{if(m<=0)return;const s=setInterval(()=>w(e=>e-1),1e3);return()=>clearInterval(s)},[m]);const j=s=>s.replace(/\D/g,""),D=()=>c.join(""),b=c.every(s=>s.length===1),I=(s,e)=>{const r=j(s);if(r.length===0){const i=[...c];i[e]="",p(i);return}const n=r.split(""),l=[...c];let t=e;for(let i=0;i<n.length&&t<6;i++,t++)l[t]=n[i];p(l);const f=l.findIndex(i=>i===""),N=f===-1?Math.min(t-1,5):Math.max(e+1,Math.min(f,5));a.current[N]?.focus(),a.current[N]?.select()},O=(s,e)=>{if(s.key==="Backspace"){if(c[e]){const r=[...c];r[e]="",p(r)}else e>0&&(a.current[e-1]?.focus(),a.current[e-1]?.select());return}s.key==="ArrowLeft"&&e>0&&(a.current[e-1]?.focus(),a.current[e-1]?.select()),s.key==="ArrowRight"&&e<5&&(a.current[e+1]?.focus(),a.current[e+1]?.select())},L=(s,e)=>{s.preventDefault();const r=j(s.clipboardData.getData("text")).slice(0,6-e);if(!r)return;const n=[...c];for(let t=0;t<r.length&&e+t<6;t++)n[e+t]=r[t];p(n);const l=Math.min(e+r.length-1,5);a.current[l]?.focus(),a.current[l]?.select()},S=async()=>{if(x)return;if(!b){d.error("Please enter the 6-digit code.");return}h(!0);const s=D(),e=new FormData;e.append("otp",s),e.append("email",localStorage.getItem("Email")||"");try{const r=new URL(`${C}/auth/verify_otp/`),n=await fetch(r.toString(),{method:"POST",body:e}),l=n.headers.get("content-type")||"";let t=null;if(l.includes("application/json"))try{t=await n.json()}catch{}else try{t=await n.text()}catch{}if(!n.ok){console.groupCollapsed(`❌ verify_otp failed ${n.status} ${n.statusText}`),console.log(typeof t=="string"?t:JSON.stringify(t,null,2)),console.groupEnd();const f=t&&(t.error||t.detail||t.message)||"Verification failed";d.error(f);return}t&&typeof t!="string"&&t.temp_token&&P(t.temp_token),localStorage.removeItem("Email"),E("/CreatePassword")}catch(r){console.error("Verify error:",r),d.error("Invalid or expired code. Please try again.")}finally{h(!1)}},T=async()=>{if(g||m>0)return;const s=k||localStorage.getItem("Email")||"";if(!s){d.error("Email missing. Go back and enter your email again.");return}y(!0);try{const e=new URL(`${C}/auth/send_otp/`),r=new FormData;r.append("email",s);const n=await fetch(e.toString(),{method:"POST",body:r}),l=n.headers.get("content-type")||"";let t=null;if(l.includes("application/json"))try{t=await n.json()}catch{}else try{t=await n.text()}catch{}if(!n.ok){console.groupCollapsed(`❌ resend_otp failed ${n.status} ${n.statusText}`),console.log(typeof t=="string"?t:JSON.stringify(t,null,2)),console.groupEnd();const f=t&&(t.error||t.detail||t.message)||"Resend failed";d.error(f);return}d.success(typeof t=="string"?"OTP sent":t?.message||"OTP sent"),p(Array(6).fill("")),a.current[0]?.focus(),w(R)}catch(e){console.error("Resend error:",e),d.error("Network error. Please try again.")}finally{y(!1)}};return o.jsxs("div",{className:"grid md:grid-cols-5 w-full min-h-screen",children:[o.jsx(A,{}),o.jsx("div",{className:"md:col-span-3 flex items-center justify-center px-4 sm:px-6 md:px-8 py-8",children:o.jsxs("div",{className:"w-full max-w-lg",children:[o.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-3 mb-6 sm:mb-8",children:[o.jsx("h1",{className:"text-primary-blue font-semibold sm:text-4xt text-3xl text-center leading-tight",children:"Enter your passcode"}),o.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm text-gray-700 text-center",children:"We’ve sent the code to the email on your device"})]}),o.jsxs("form",{className:"flex flex-col gap-5 sm:gap-6",onSubmit:s=>{s.preventDefault(),S()},children:[o.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-3 md:gap-4",children:Array.from({length:6}).map((s,e)=>o.jsx("input",{ref:r=>{a.current[e]=r},type:"tel",inputMode:"numeric",pattern:"[0-9]*",autoComplete:"one-time-code",maxLength:1,value:c[e],onChange:r=>I(r.target.value,e),onKeyDown:r=>O(r,e),onPaste:r=>L(r,e),placeholder:"-",className:`w-10 h-12 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16\r
                             text-center text-base sm:text-lg md:text-xl font-medium\r
                             rounded-2xl bg-white border border-gray-200 placeholder-gray-300\r
                             outline-none focus:ring-2 focus:ring-primary-blue/20 focus:border-primary-blue/50`},e))}),o.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2",children:[o.jsx("span",{className:"text-xs sm:text-sm font-medium text-primary-purple/80","aria-live":"polite",children:m>0?`Resend code in ${m} sec`:"You can resend the code now"}),o.jsx("button",{type:"button",onClick:T,disabled:m>0||g,className:`text-sm font-semibold underline-offset-2 transition ${m>0||g?"text-gray-400 cursor-not-allowed":"text-primary-purple hover:text-primary-purple/90"}`,children:g?"Resending...":"Resend"})]}),o.jsx(M,{text:x?"Verifying...":"Submit",onClick:()=>void S(),disabled:x||!b})]})]})}),o.jsx(B,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})]})};export{G as default};
